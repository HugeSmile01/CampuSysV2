<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <meta name="description" content="A secure campus management system that helps streamline academic processes.">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="res/material.cyan-light_blue.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/login.css">
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="JavaScript/security.js"></script>
    <script src="JavaScript/auth.js"></script>
        <div class="mdl-grid demo-content">
          <div class="login-form">
            <h2>Login</h2>
            <form id="login-form">
                <div class="input-group">
                    <input type="email" id="email" placeholder="Email" required maxlength="254">
                    <span class="input-error" id="email-error"></span>
                </div>
                <div class="input-group">
                    <input type="password" id="password" placeholder="Password" required>
                    <span class="input-error" id="password-error"></span>
                </div>
                <button type="submit" class="login-btn">Login</button>
                <div class="form-options">
                    <button type="button" class="link-btn" onclick="showPasswordReset()">Forgot Password?</button>
                </div>
                <div class="social-login">
                    <button type="button" class="social-btn google-btn" onclick="loginWithGoogle()">
                        Login with Google
                    </button>
                    <button type="button" class="social-btn facebook-btn" onclick="loginWithFacebook()">
                        Login with Facebook
                    </button>
                </div>
                <div class="form-footer">
                    <p>Don't have an account? <a href="registration.html">Sign up here</a></p>
                </div>
                <div id="login-error" class="error-message"></div>
            </form>
          </div>
        </div>
      </main>
    </div>
    
    <script src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script>
        // Enhanced login form handling
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Clear previous error messages
            document.getElementById('email-error').textContent = '';
            document.getElementById('password-error').textContent = '';
            
            // Basic validation
            if (!email || !password) {
                if (!email) document.getElementById('email-error').textContent = 'Email is required';
                if (!password) document.getElementById('password-error').textContent = 'Password is required';
                return;
            }
            
            login(email, password);
        });
        
        // Real-time email validation
        document.getElementById('email').addEventListener('blur', function() {
            const email = this.value.trim();
            const errorElement = document.getElementById('email-error');
            
            if (email && !securityManager.validateEmail(email)) {
                errorElement.textContent = 'Please enter a valid email address';
                this.classList.add('error');
            } else {
                errorElement.textContent = '';
                this.classList.remove('error');
            }
        });
        
        // Password reset dialog
        function showPasswordReset() {
            Swal.fire({
                title: 'Reset Password',
                input: 'email',
                inputLabel: 'Enter your email address',
                inputPlaceholder: 'your.email@example.com',
                showCancelButton: true,
                confirmButtonText: 'Send Reset Email',
                inputValidator: (value) => {
                    if (!value) {
                        return 'Please enter your email address';
                    }
                    if (!securityManager.validateEmail(value)) {
                        return 'Please enter a valid email address';
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    resetPassword(result.value);
                }
            });
        }
    </script>
</body>
</html>
